<!DOCTYPE html>
<html lang="pt-BR">
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin - Produtos</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <h1>Painel Admin</h1>
    <div class="header-topo">
      <nav class="main-nav">
        <ul class="nav-list">
          <li><a href="../index.html">Sair</a></li>
        </ul>
      </nav>
    </div>

  <form id="form-produto">
    <input type="hidden" name="id" />
    <div><label>Nome</label><input name="nome" required /></div>
    <div><label>Preço</label><input name="preco" type="number" step="0.01" required /></div>
    <div><label>Imagem (caminho)</label><input name="imagem" /></div>
    <div><label>Descrição</label><textarea name="descricao"></textarea></div>
    <div><label>Categoria</label><input name="categoria" /></div>
    <button type="submit">Salvar</button>
    <button type="button" id="btn-cancel" style="display:none">Cancelar</button>
  </form>

  <h2>Produtos Cadastrados</h2>
  <div id="lista-admin"></div>

  <script>
  const API = 'http://localhost:3000/api/produtos';

  async function carregarAdmin() {
    const res = await fetch(API);
    const produtos = await res.json();
    document.getElementById('lista-admin').innerHTML = produtos.map(p => `
      <div class="admin-item" data-id="${p.id}">
        <img src="${p.imagem}" alt="${p.nome}" style="max-width:80px"/>
        <div class="info">
          <strong>${p.nome}</strong>
          <p>R$ ${Number(p.preco).toFixed(2)}</p>
        </div>
        <div class="acoes">
          <button onclick="editar(${p.id})">Editar</button>
          <button onclick="excluir(${p.id})">Excluir</button>
        </div>
      </div>
    `).join('');
  }

  document.getElementById('form-produto').addEventListener('submit', async (e) => {
    e.preventDefault();
    const f = e.target;
    const body = {
      nome: f.nome.value,
      preco: Number(f.preco.value),
      imagem: f.imagem.value,
      descricao: f.descricao.value,
      categoria: f.categoria.value
    };
    const id = f.id.value;
    if (id) {
      await fetch(`${API}/${id}`, { method: 'PUT', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
    } else {
      await fetch(API, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
    }
    f.reset();
    document.getElementById('btn-cancel').style.display = 'none';
    carregarAdmin();
  });

  async function excluir(id) {
    if (!confirm('Confirma exclusão?')) return;
    await fetch(`${API}/${id}`, { method: 'DELETE' });
    carregarAdmin();
  }

  async function editar(id) {
    const res = await fetch(`${API}/${id}`);
    const p = await res.json();
    const f = document.getElementById('form-produto');
    f.id.value = p.id;
    f.nome.value = p.nome;
    f.preco.value = p.preco;
    f.imagem.value = p.imagem || '';
    f.descricao.value = p.descricao || '';
    f.categoria.value = p.categoria || '';
    document.getElementById('btn-cancel').style.display = 'inline-block';
    document.getElementById('btn-cancel').onclick = () => { f.reset(); f.id.value=''; document.getElementById('btn-cancel').style.display='none'; };
  }

  window.addEventListener('DOMContentLoaded', carregarAdmin);
  </script>

  <footer class="site-footer">
    <p>&copy; Stopeças 2025</p>
  </footer>
  
</body>
</html>
