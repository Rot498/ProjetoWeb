<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do Produto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <script src="js/config.js" defer></script>
  <script src="js/carrinho-header.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js" defer></script>
</head>
<body>
  <header class="site-header">
    <div class="header-topo">
      <button id="site-burger" aria-label="Abrir menu" aria-expanded="false" class="d-md-none ms-auto">‚ò∞</button>
      <a href="index.html" class="logo">Stope√ßas</a>
      <nav class="main-nav">
        <ul class="nav-list">
          <li><a href="index.html">In√≠cio</a></li>
          <li><a href="produto.html">Produtos</a></li>
          <li><a href="categoria.html">Categorias</a></li>
          <li><a href="suporte.html">Suporte</a></li>
        </ul>
      </nav>
      <a href="carrinho.html" class="cart-link" aria-label="Ir para o carrinho">
        üõí <span id="contadorCarrinho" class="contador-carrinho">0</span>
      </a>
    </div>
  </header>

  <main class="conteudo">
    <a href="javascript:history.back()" class="botao-finalizar" style="margin-bottom:16px; display:inline-block;">‚Üê Voltar</a>
    <div id="detalhe"></div>
  </main>

  <footer class="site-footer">
    <p>&copy; Stope√ßas 2025</p>
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const API = (typeof window.API_PRODUTOS !== 'undefined' ? window.API_PRODUTOS : `http://${window.location.hostname || 'localhost'}:3000/api/produtos`);
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    const container = document.getElementById('detalhe');

    if (!id || !container) {
      if (container) container.textContent = 'Produto n√£o encontrado.';
      return;
    }

    async function carregar(){
      try {
        const res = await fetch(API + '/' + encodeURIComponent(id));
        if (!res.ok) {
          container.textContent = 'Produto n√£o encontrado.';
          return;
        }
        const p = await res.json();

        container.innerHTML = `
          <section class="featured-prducts">
            <article class="product-card">
              <img src="${p.imagem}" alt="${p.nome}">
              <h2>${p.nome}</h2>
              <p class="product-description">${p.descricao || ''}</p>
              <p class="product-price">R$ ${Number(p.preco).toFixed(2)}</p>
              <p><strong>C√≥digo:</strong> ${p.id}</p>
              <p><strong>Categoria:</strong> ${p.categoria || ''}</p>
              <div class="product-actions">
                <button id="btn-add">Adicionar ao carrinho</button>
              </div>
            </article>
          </section>
        `;

        const btnVoltar = document.getElementById('btn-voltar');
        if (btnVoltar){
          btnVoltar.addEventListener('click', () => history.back());
        }

        const btnAdd = document.getElementById('btn-add');
        if (btnAdd){
          btnAdd.addEventListener('click', () => {
            let carrinho;
            try{
              carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            }catch(e){
              carrinho = [];
            }
            const existente = carrinho.find(i => String(i.id) === String(p.id));
            if (existente) existente.qtd = (existente.qtd || 1) + 1;
            else carrinho.push({ id: p.id, qtd: 1 });
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            if (typeof window.atualizarContadorCarrinho === 'function') {
              window.atualizarContadorCarrinho();
            }
            alert('Adicionado ao carrinho');
          });
        }
      } catch (err) {
        console.error(err);
        container.textContent = 'Erro ao carregar produto.';
      }
    }

    carregar();
  });
  </script>
</body>
</html>
