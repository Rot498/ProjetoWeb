<!DOCTYPE html>
<html lang="pt-BR">
<!doctype html>
<head>
  <meta charset="utf-8">
  <title>Detalhes do Produto</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <a href="index.html">← Voltar</a>
  <div id="detalhe"></div>

  <script>
  const API = 'http://localhost:3000/api/produtos';
  const params = new URLSearchParams(location.search);
  const id = params.get('id');

  async function carregar() {
    if (!id) {
      document.getElementById('detalhe').innerText = 'Produto inválido';
      return;
    }
    try {
      const res = await fetch(`${API}/${id}`);
      if (!res.ok) { document.getElementById('detalhe').innerText = 'Produto não encontrado'; return; }
      const p = await res.json();
      document.getElementById('detalhe').innerHTML = `
        <div class="produto-detalhe">
          <img src="${p.imagem}" alt="${p.nome}" style="max-width:240px"/>
          <div>
            <h1>${p.nome}</h1>
            <p>${p.descricao || ''}</p>
            <p>R$ ${Number(p.preco).toFixed(2)}</p>
            <button id="btn-add">Adicionar ao Carrinho</button>
          </div>
        </div>
      `;
      document.getElementById('btn-add').addEventListener('click', () => {
        const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
        const item = carrinho.find(i => i.id === p.id);
        if (item) item.qtd++;
        else carrinho.push({ id: p.id, qtd: 1 });
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        alert('Adicionado ao carrinho');
      });
    } catch (err) { console.error(err); document.getElementById('detalhe').innerText = 'Erro ao carregar'; }
  }

  document.addEventListener('DOMContentLoaded', carregar);
  </script>
</body>
</html>
